// Celebration messages for different milestones
window.celebrationMessages = {
    50: {
        english: {
            text: ["Half Century!", "50 Points!", "Amazing Start!"],
            voice: ["Wow! Fifty points!", "Great job! Fifty!", "Half century achieved!"]
        },
        sinhala: {
            text: ["à¶…à¶»à·Šà¶° à·à¶­à¶šà¶º!", "à¶½à¶šà·”à¶«à·” 50!", "à¶…à¶´à·–à¶»à·” à¶†à¶»à¶¸à·Šà¶·à¶º!", "à·„à¶»à·’à¶¸ à¶½à·ƒà·Šà·ƒà¶±!", "à¶´à¶±à·„ à¶½à¶šà·”à¶«à·”!"],
            voice: ["à·€à·à·€à·Š! à¶½à¶šà·”à¶«à·” à¶´à¶±à·„!", "à·„à·œà¶³à¶§à¶¸! à¶´à¶±à·„!", "à¶…à¶»à·Šà¶° à·à¶­à¶šà¶º à·ƒà·à¶šà·Šà·‚à·à¶­à·Š à¶šà¶»à¶œà¶­à·Šà¶­à·!", "à¶…à¶´à·–à¶»à·” à¶†à¶»à¶¸à·Šà¶·à¶ºà¶šà·Š!", "à¶½à¶šà·”à¶«à·” à¶´à¶±à·„ à¶½à·à¶¶à·”à¶«à·!"]
        }
    },
    100: {
        english: {
            text: ["Century!", "100 Points!", "You're a Star!"],
            voice: ["Amazing! One hundred points!", "Century completed!", "You are a superstar!"]
        },
        sinhala: {
            text: ["à·à¶­à¶šà¶º!", "à¶½à¶šà·”à¶«à·” 100!", "à¶”à¶¶ à¶­à¶»à·”à·€à¶šà·Š!", "à·ƒà·’à¶ºà¶º à¶½à¶šà·”à¶«à·”!", "à¶…à¶´à·–à¶»à·” à¶¯à·’à¶ºà·”à¶«à·”à·€!"],
            voice: ["à¶…à¶´à·–à¶»à·”! à¶½à¶šà·”à¶«à·” à·ƒà·’à¶ºà¶º!", "à·à¶­à¶šà¶º à·ƒà¶¸à·Šà¶´à·–à¶»à·Šà¶«!", "à¶”à¶¶ à·ƒà·”à¶´à·’à¶»à·’ à¶­à¶»à·”à·€à¶šà·Š!", "à¶½à¶šà·”à¶«à·” à·ƒà·’à¶ºà¶º à·ƒà·à¶šà·Šà·‚à·à¶­à·Š à¶šà¶»à¶œà¶­à·Šà¶­à·!", "à·€à·’à·à·’à·‚à·Šà¶§ à¶šà·à¶»à·Šà¶º à·ƒà·à¶°à¶±à¶º!"]
        }
    },
    200: {
        english: {
            text: ["Double Century!", "200 Points!", "Incredible!"],
            voice: ["Incredible! Two hundred points!", "Double century!", "You are unbelievable!"]
        },
        sinhala: {
            text: ["à¶¯à·Šà·€à·’à¶­à·Šà·€ à·à¶­à¶šà¶º!", "à¶½à¶šà·”à¶«à·” 200!", "à¶‡à¶¯à·„à·’à¶º à¶±à·œà·„à·à¶šà·’!", "à¶¯à·™à·ƒà·’à¶ºà¶º à¶½à¶šà·”à¶«à·”!", "à·€à·’à·à·’à·‚à·Šà¶§à¶ºà·’!"],
            voice: ["à¶‡à¶¯à·„à·’à¶º à¶±à·œà·„à·à¶šà·’! à¶½à¶šà·”à¶«à·” à¶¯à·™à·ƒà·’à¶ºà¶º!", "à¶¯à·Šà·€à·’à¶­à·Šà·€ à·à¶­à¶šà¶º!", "à¶”à¶¶ à¶‡à¶¯à·„à·’à¶º à¶±à·œà·„à·à¶šà·’!", "à¶½à¶šà·”à¶«à·” à¶¯à·™à·ƒà·’à¶ºà¶º à·ƒà·à¶šà·Šà·‚à·à¶­à·Š à¶šà¶»à¶œà¶­à·Šà¶­à·!", "à¶…à¶­à·’à·€à·’à·à·’à·‚à·Šà¶§ à¶¯à¶šà·Šà·‚à¶­à·à·€!"]
        }
    },
    300: {
        english: {
            text: ["Triple Century!", "300 Points!", "Unstoppable!"],
            voice: ["Fantastic! Three hundred points!", "Triple century!", "You are unstoppable!"]
        },
        sinhala: {
            text: ["à¶­à·Šâ€à¶»à·’à¶­à·Šà·€ à·à¶­à¶šà¶º!", "à¶½à¶šà·”à¶«à·” 300!", "à¶±à·€à¶­à·Šà·€à·’à¶º à¶±à·œà·„à·à¶šà·’!", "à¶­à·”à¶±à·Šà·ƒà·’à¶ºà¶º à¶½à¶šà·”à¶«à·”!", "à¶¯à·’à¶±à·™à¶±à·Š à¶¯à·’à¶± à·„à·œà¶³ à·€à·™à¶±à·€à·!"],
            voice: ["à·€à·’à·à·’à·‚à·Šà¶§! à¶½à¶šà·”à¶«à·” à¶­à·”à¶±à·Šà·ƒà·’à¶ºà¶º!", "à¶­à·Šâ€à¶»à·’à¶­à·Šà·€ à·à¶­à¶šà¶º!", "à¶”à¶¶ à¶±à·€à¶­à·Šà·€à·’à¶º à¶±à·œà·„à·à¶šà·’!", "à¶½à¶šà·”à¶«à·” à¶­à·”à¶±à·Šà·ƒà·’à¶ºà¶º à·ƒà·à¶šà·Šà·‚à·à¶­à·Š à¶šà¶»à¶œà¶­à·Šà¶­à·!", "à¶…à¶­à·’à·à¶ºà·’à¶±à·Šà¶¸ à·€à·’à·à·’à·‚à·Šà¶§à¶ºà·’!"]
        }
    },
    400: {
        english: {
            text: ["400 Points!", "Fantastic!", "Keep Going!"],
            voice: ["Wonderful! Four hundred points!", "Fantastic score!", "Keep going strong!"]
        },
        sinhala: {
            text: ["à¶½à¶šà·”à¶«à·” 400!", "à·€à·’à·à·’à·‚à·Šà¶§à¶ºà·’!", "à¶¯à·’à¶œà¶§à¶¸ à¶šà¶»à¶œà·™à¶± à¶ºà¶±à·Šà¶±!", "à·„à·à¶»à·ƒà·’à¶ºà¶º à¶½à¶šà·”à¶«à·”!", "à¶…à¶´à·–à¶»à·” à¶¯à¶šà·Šà·‚à¶­à·à·€!"],
            voice: ["à¶…à¶´à·–à¶»à·”! à¶½à¶šà·”à¶«à·” à·„à·à¶»à·ƒà·’à¶ºà¶º!", "à·€à·’à·à·’à·‚à·Šà¶§ à¶½à¶šà·”à¶«à·”!", "à¶¯à·’à¶œà¶§à¶¸ à·à¶šà·Šà¶­à·’à¶¸à¶­à·Šà·€ à¶šà¶»à¶œà·™à¶± à¶ºà¶±à·Šà¶±!", "à¶½à¶šà·”à¶«à·” à·„à·à¶»à·ƒà·’à¶ºà¶º à·ƒà·à¶šà·Šà·‚à·à¶­à·Š à¶šà¶»à¶œà¶­à·Šà¶­à·!", "à·€à·’à·à·’à·‚à·Šà¶§à¶­à¶¸ à¶šà·à¶»à·Šà¶º à·ƒà·à¶°à¶±à¶º!"]
        }
    }
};

// Messages for red balls only
window.redBallMessages = {
    english: [
        "Careful!",
        "Watch out!",
        "Danger!",
        "Be careful!",
        "Red alert!",
        "Warning!",
        "Oh no!",
        "Uh oh!"
    ],
    sinhala: [
        "à¶´à·Šâ€à¶»à·€à·šà·à¶¸à·Š à·€à¶±à·Šà¶±!",
        "à¶…à¶±à¶­à·”à¶»à·” à¶‡à¶œà·€à·“à¶¸!",
        "à¶…à¶±à·Šà¶­à¶»à·à¶º!",
        "à·ƒà·à¶½à¶šà·’à¶½à·’à¶¸à¶­à·Š à·€à¶±à·Šà¶±!",
        "à¶»à¶­à·” à¶‡à¶Ÿà·€à·“à¶¸!",
        "à¶…à·€à¶¯à·à¶±à¶¸!",
        "à¶…à¶´à·œà¶ºà·’!",
        "à¶…à·„à·!"
    ]
};

// System messages
window.systemMessages = {
    gameStart: {
        english: "Help Flippy the Fish!",
        sinhala: "à·†à·Šà¶½à·’à¶´à·Šà¶´à·“ à¶¸à·à·…à·”à·€à·à¶§ à¶‹à¶¯à·€à·Š à¶šà¶»à¶±à·Šà¶±!"
    },
    gamePaused: {
        english: "Paused",
        sinhala: "à¶­à·à·€à¶šà·à¶½à·’à¶šà·€ à¶±à¶­à¶» à¶šà·…à·"
    },
    gameOver: {
        english: "Game Over!",
        sinhala: "à¶šà·Šâ€à¶»à·“à¶©à·à·€ à¶…à·€à·ƒà¶±à·Š!"
    },
    soundsOn: {
        english: "Sounds On",
        sinhala: "à·à¶¶à·Šà¶¯ à·ƒà¶šà·Šâ€à¶»à·’à¶ºà¶ºà·’"
    },
    soundsOff: {
        english: "Sounds Off",
        sinhala: "à·à¶¶à·Šà¶¯ à¶…à¶šà·Šâ€à¶»à·’à¶ºà¶ºà·’"
    },
    voiceOn: {
        english: "Voice On",
        sinhala: "à¶šà¶®à¶±à¶º à·ƒà¶šà·Šâ€à¶»à·’à¶º"
    },
    voiceOff: {
        english: "Voice Off",
        sinhala: "à¶šà¶®à¶±à¶º à¶…à¶šà·Šâ€à¶»à·’à¶º"
    },
    welcome: {
        english: "Click Start to help Flippy!",
        sinhala: "à¶†à¶»à¶¸à·Šà¶· à¶šà·’à¶»à·“à¶¸à¶§ à¶”à¶¶à¶±à·Šà¶±!"
    }
};

// Button text
window.buttonText = {
    startBtn: {
        english: "Start Game",
        sinhala: "à¶šà·Šâ€à¶»à·“à¶©à·à·€ à¶…à¶»à¶¹à¶±à·Šà¶±"
    },
    pauseBtn: {
        english: "Pause",
        sinhala: "à¶­à·à·€à¶šà·à¶½à·’à¶šà·€ à¶±à¶­à¶» à¶šà¶»à¶±à·Šà¶±"
    },
    resumeBtn: {
        english: "Resume",
        sinhala: "à¶¯à·’à¶œà¶§à¶¸ à¶šà¶»à¶±à·Šà¶±"
    },
    restartBtn: {
        english: "Restart",
        sinhala: "à¶ºà·…à·’ à¶…à¶»à¶¹à¶±à·Šà¶±"
    },
    playAgainBtn: {
        english: "Play Again",
        sinhala: "à¶ºà·…à·’ à¶šà·Šâ€à¶»à·“à¶©à· à¶šà¶»à¶±à·Šà¶±"
    },
    soundOnBtn: {
        english: "ðŸ”Š Sound On",
        sinhala: "ðŸ”Š à·à¶¶à·Šà¶¯ à·ƒà¶šà·Šâ€à¶»à·’à¶º"
    },
    soundOffBtn: {
        english: "ðŸ”‡ Sound Off",
        sinhala: "ðŸ”‡ à·à¶¶à·Šà¶¯ à¶…à¶šà·Šâ€à¶»à·’à¶º"
    },
    voiceOnBtn: {
        english: "ðŸŽ¤ Voice On",
        sinhala: "ðŸŽ¤ à¶šà¶®à¶±à¶º à·ƒà¶šà·Šâ€à¶»à·’à¶º"
    },
    voiceOffBtn: {
        english: "ðŸ”‡ Voice Off",
        sinhala: "ðŸ”‡ à¶šà¶®à¶±à¶º à¶…à¶šà·Šâ€à¶»à·’à¶º"
    }
};

// Function to show a message
window.showMessage = function(text, type, x, y) {
    if (!window.gameState.messagesContainer) return;
    
    const message = document.createElement('div');
    message.className = `message ${type}`;
    message.textContent = text;
    
    const offsetX = Math.random() * 100 - 50;
    message.style.left = `${x + offsetX}px`;
    message.style.top = `${y}px`;
    
    window.gameState.messagesContainer.appendChild(message);
    
    setTimeout(() => {
        if (message.parentNode) {
            message.parentNode.removeChild(message);
        }
    }, type === 'celebration' ? 3000 : 2000);
    
    return message;
};

// Update button texts based on current language
window.updateButtonTexts = function() {
    const gs = window.gameState;
    if (!gs.currentLanguage) return;
    
    const btns = [
        ['startBtn', 'startBtn'],
        ['pauseBtn', 'pauseBtn'],
        ['restartBtn', 'restartBtn'],
        ['playAgainBtn', 'playAgainBtn'],
        ['soundOnBtn', 'soundOnBtn'],
        ['soundOffBtn', 'soundOffBtn'],
        ['voiceOnBtn', 'voiceOnBtn'],
        ['voiceOffBtn', 'voiceOffBtn']
    ];
    
    btns.forEach(([id, key]) => {
        const btn = document.getElementById(id);
        if (btn && window.buttonText[key]) {
            btn.textContent = window.buttonText[key][gs.currentLanguage];
        }
    });
    
    if (gs.gamePaused && document.getElementById('pauseBtn')) {
        document.getElementById('pauseBtn').textContent = window.buttonText.resumeBtn[gs.currentLanguage];
    }
};

// Create celebration particles
window.createParticles = function(x, y, count, type) {
    for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        
        if (type === 'confetti') {
            particle.className = 'confetti';
            particle.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 60%)`;
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            particle.style.transform = `rotate(${Math.random() * 360}deg)`;
            particle.style.width = `${Math.random() * 10 + 5}px`;
            particle.style.height = `${Math.random() * 15 + 10}px`;
        } else if (type === 'star') {
            particle.className = 'star';
            particle.innerHTML = 'â˜…';
            particle.style.left = `${x}px`;
            particle.style.top = `${y}px`;
            particle.style.fontSize = `${Math.random() * 20 + 15}px`;
            particle.style.color = `hsl(${Math.random() * 60 + 40}, 100%, 50%)`;
        }
        
        particle.className += ' particle';
        document.body.appendChild(particle);
        
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 5 + 2;
        const vx = Math.cos(angle) * speed;
        const vy = Math.sin(angle) * speed - 2;
        const rotation = Math.random() * 10 - 5;
        const gravity = 0.1;
        const life = 100 + Math.random() * 50;
        
        window.gameState.particles.push({
            element: particle,
            x: x,
            y: y,
            vx: vx,
            vy: vy,
            rotation: rotation,
            gravity: gravity,
            life: life,
            maxLife: life
        });
    }
};

// Update particles
window.updateParticles = function() {
    const gs = window.gameState;
    for (let i = gs.particles.length - 1; i >= 0; i--) {
        const p = gs.particles[i];
        
        p.x += p.vx;
        p.y += p.vy;
        p.vy += p.gravity;
        p.life--;
        
        if (p.element.className.includes('confetti')) {
            p.element.style.transform = `rotate(${p.rotation * p.life}deg)`;
        }
        
        p.element.style.left = `${p.x}px`;
        p.element.style.top = `${p.y}px`;
        p.element.style.opacity = p.life / p.maxLife;
        
        if (p.life <= 0 || p.y > (gs.canvas?.height || 500) + 100) {
            if (p.element.parentNode) {
                p.element.parentNode.removeChild(p.element);
            }
            gs.particles.splice(i, 1);
        }
    }
};

// Celebration effect for milestones with voice
window.triggerCelebration = function(scoreValue) {
    const gs = window.gameState;
    if (!gs.gameRunning) return;
    
    // Play celebration sound
    if (gs.soundEnabled && gs.sounds.celebration) {
        gs.sounds.celebration.play();
        setTimeout(() => {
            if (gs.sounds.levelUp) gs.sounds.levelUp.play();
        }, 500);
    }
    
    // Get celebration messages in current language
    let textMessage, voiceMessage;
    if (window.celebrationMessages[scoreValue]) {
        const textMessages = window.celebrationMessages[scoreValue][gs.currentLanguage].text;
        const voiceMessages = window.celebrationMessages[scoreValue][gs.currentLanguage].voice;
        
        textMessage = textMessages[Math.floor(Math.random() * textMessages.length)];
        voiceMessage = voiceMessages[Math.floor(Math.random() * voiceMessages.length)];
    } else {
        textMessage = gs.currentLanguage === 'sinhala' 
            ? `à¶½à¶šà·”à¶«à·” ${scoreValue}!` 
            : `${scoreValue} Points!`;
        
        voiceMessage = gs.currentLanguage === 'sinhala'
            ? `à¶½à¶šà·”à¶«à·” ${scoreValue}!`
            : `${scoreValue} points!`;
    }
    
    // Show celebration text message
    const canvas = gs.canvas;
    if (canvas) {
        showMessage(textMessage, "celebration", canvas.width/2, canvas.height/2);
    }
    
    // Speak celebration voice message
    if (gs.voiceEnabled && gs.speechSynthesisSupported && window.speakText) {
        setTimeout(() => window.speakText(voiceMessage), 500);
    }
    
    // Create particles
    if (canvas) {
        createParticles(canvas.width/2, canvas.height/2, 100, 'confetti');
        createParticles(canvas.width/2, canvas.height/2, 20, 'star');
    }
    
    // Make the fish happy
    if (gs.fish) {
        gs.fish.happy = true;
        gs.fish.happyTimer = 60;
    }
    
    // Spawn bonus balls
    for (let i = 0; i < 3; i++) {
        setTimeout(() => {
            if (gs.gameRunning && window.createBallWithQuarterRedFrequency) {
                window.createBallWithQuarterRedFrequency();
            }
        }, i * 200);
    }
};

// Check for milestone celebrations
window.checkForCelebration = function(newScore) {
    const gs = window.gameState;
    
    // Check for specific milestones
    const milestones = [50, 100, 150, 200, 250, 300, 350, 400];
    
    for (const milestone of milestones) {
        if (newScore >= milestone && gs.lastCelebrationScore < milestone) {
            window.triggerCelebration(milestone);
            gs.lastCelebrationScore = milestone;
            return;
        }
    }
    
    // Also celebrate every 50 points after 50 for more frequent celebrations
    if (newScore > 50 && newScore % 50 === 0 && gs.lastCelebrationScore < newScore) {
        window.triggerCelebration(newScore);
        gs.lastCelebrationScore = newScore;
    }
};